<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR Debug</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
            touch-action: none; /* Disable dragging */
        }
    </style>
</head>
<body>
    <a-scene embedded arjs gps-camera="minAccuracy: 20">

        <!-- GPS Text -->
        <a-text 
            id="gps-text" 
            value="Getting GPS..." 
            position="-1 1 -8"  
            scale="0.5 0.5 0.5"   
            color="white">
        </a-text>

        <a-text 
            id="cube-coordinates" 
            value="Cube Position: Lat: 0, Lon: 0" 
            position="-1 0 -8" 
            scale="0.5 0.5 0.5"   
            color="yellow">
        </a-text>

        <!-- Red Square (1 Meter in Front) -->
       <a-plane 
            id="red-square" 
            position="0 0 -10"  
            width="0.1" 
            height="0.1" 
            color="red">
        </a-plane>

        <!-- Fixed Camera (Prevents Dragging) -->
        <a-camera gps-camera rotation-reader look-controls="enabled: false" position="0 0 0"></a-camera>

    </a-scene>
 <script>
        let currentLat, currentLon;

        // Watch the GPS position
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(
                (position) => {
                    currentLat = position.coords.latitude;
                    currentLon = position.coords.longitude;

                    // Log the location for debugging
                    console.log("Latitude:", currentLat, "Longitude:", currentLon);

                    // Update the GPS text element
                    const gpsText = document.getElementById("gps-text");
                    gpsText.setAttribute("value", `Lat: ${currentLat.toFixed(4)} \nLon: ${currentLon.toFixed(4)}`);
                },
                (error) => {
                    console.error("Error getting location:", error);
                    alert("Please enable GPS to see the AR model.");
                },
                {
                    enableHighAccuracy: true,
                    maximumAge: 10000,
                    timeout: 5000,
                }
            );
        } else {
            alert("Geolocation is not supported by this browser.");
        }

        // Get device orientation (alpha = compass direction)
        let alpha = 0;  // Default value for alpha (compass direction)

        window.addEventListener('deviceorientation', (event) => {
            alpha = event.alpha;  // Get the current compass direction
        });

        // Function to move the square based on direction
        function moveSquare() {
            if (currentLat === undefined || currentLon === undefined) {
                return; // Don't move the square until we have GPS coordinates
            }

            const distance = 5;  // Distance in meters

            // Calculate direction in radians
            const directionInRadians = (alpha * Math.PI) / 180;

            // Calculate the changes in latitude and longitude
            const deltaLat = distance * Math.cos(directionInRadians) / 111320;  // Latitude change per meter
            const deltaLon = distance * Math.sin(directionInRadians) / (40008000 * Math.cos(currentLat * Math.PI / 180) / 360);  // Longitude change per meter

            // New coordinates based on the direction
            const newLat = currentLat + deltaLat;
            const newLon = currentLon + deltaLon;

            // Move the red square to the new position
            const square = document.getElementById('red-square');
            square.setAttribute('position', `${newLon} 0 ${newLat}`);

            // Update the coordinates of the cube text
            const cubeCoordinates = document.getElementById("cube-coordinates");
            cubeCoordinates.setAttribute("value", `Cube Position: Lat: ${newLat.toFixed(4)} Lon: ${newLon.toFixed(4)}`);
            
            console.log(`Moved square to Lat: ${newLat}, Lon: ${newLon}`);
        }

        // Continuously move the square every 2 seconds
        setInterval(moveSquare, 2000);  // Move square every 2 seconds
    </script>
</body>
</html>
