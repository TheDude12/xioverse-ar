<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR Debug</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs gps-camera="minAccuracy: 20">
        <a-text id="gps-text" value="Getting GPS..." position="0 3 -5" color="white"></a-text>
        <a-text value="GPS is working!" position="0 2 -5"></a-text>
        <!-- Flashing Green Dots (Guide to Target Location) -->
    <a-entity 
        id="guidanceDots"
        gps-entity-place="latitude: 33.873717; longitude: 35.521254"
        geometry="primitive: sphere; radius: 0.2" 
        material="color: green; opacity: 0.8"
        animation="property: material.opacity; from: 0; to: 1; dir: alternate; dur: 500; loop: true">
    </a-entity>
  <!-- Hidden "Box Here" Text -->
    <a-text 
        id="boxText"
        value="Box Here" 
        position="0 2 -5" 
        visible="false"
        color="white">
    </a-text>
 <a-entity 
        id="targetBox"
        gps-entity-place="latitude: 33.873717; longitude: 35.521254" 
        geometry="primitive: box" 
        material="color: red"
        scale="1 1 1"
        visible="false">
    </a-entity>

        <a-camera gps-camera rotation-reader></a-camera>

        <!-- Example Entity -->
     

    </a-scene>

    <script>
    if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
            (position) => {
                let lat = position.coords.latitude.toFixed(6);
                let lon = position.coords.longitude.toFixed(6);
                console.log("User location:", lat, lon);
                
                // Update the on-screen text with coordinates
                document.getElementById("gps-text").setAttribute("value", `Lat: ${lat}, Lon: ${lon}`);
            },
            (error) => {
                console.error("Error getting location:", error);
                alert("Please enable GPS to see the AR model.");
            },
            { enableHighAccuracy: true }
        );
    } else {
        alert("Geolocation is not supported by this browser.");
    }
</script>

<script>
    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371e3; // Earth's radius in meters
        const φ1 = lat1 * Math.PI / 180;
        const φ2 = lat2 * Math.PI / 180;
        const Δφ = (lat2 - lat1) * Math.PI / 180;
        const Δλ = (lon2 - lon1) * Math.PI / 180;

        const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                  Math.cos(φ1) * Math.cos(φ2) *
                  Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

        return R * c; // Distance in meters
    }

    function checkDistance() {
        navigator.geolocation.getCurrentPosition((position) => {
            const userLat = position.coords.latitude;
            const userLon = position.coords.longitude;

            const targetLat = 33.873717;
            const targetLon = 35.521254;

            const distance = getDistance(userLat, userLon, targetLat, targetLon);

            console.log("Distance to box:", distance, "meters");

            if (distance < 3) {
                document.querySelector("#guidanceDots").setAttribute("visible", "false");
                document.querySelector("#boxText").setAttribute("visible", "true");
                document.querySelector("#targetBox").setAttribute("visible", "true");
            } else {
                document.querySelector("#guidanceDots").setAttribute("visible", "true");
                document.querySelector("#boxText").setAttribute("visible", "false");
                document.querySelector("#targetBox").setAttribute("visible", "false");
            }
        });
    }

    setInterval(checkDistance, 1000); // Check every second
</script>


</body>
</html>
